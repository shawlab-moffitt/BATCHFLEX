#' Evaluation Relative Log Expression
#'
#' @param mat A Numeric matrix or list of matrices after pre-processing and/or batch correction with features as rownames and sample names as the column names
#' @param meta Data frame of sample data with the first column being sample names that match the column names of the matrix
#' @param batch.1 Column name from the meta file of the column that will be used for batch information
#' @param variable_of_interest Column name from the meta file of the column that will be used for the variable of interest information
#' @param color_by Used by evaluation multiple components, pca, and rle to select which feature will be used to color the individuals. Choices are "batch", "variable_of_interest", "BnW", and "all". Default is set to "all"
#' @param plot_title A list of titles for each matrix submitted. Used to named the plots generated by the batch evaluate function. Default will generate titles based on the uncorrected and corrected matrices.
#'
#' @return A list object of RLE plots
#' @export
#'
#' @examples
#' set.seed(333)
evaluation_rle <- function(mat,
                           meta,
                           batch.1,
                           variable_of_interest,
                           color_by,
                           plot_title){
  evaluation_rle_list <- list()
  bpparam_rle <- BiocParallel::SnowParam(workers = 1, type = "SOCK")
  if ("batch" %in% color_by){
    rle_mat <- mat
    rle_mat_meta <- cbind(t(rle_mat), meta)
    rle_mat_meta_ordered <- rle_mat_meta[order(rle_mat_meta[[batch.1]]),]
    rle_mat_ordered <- t(rle_mat_meta_ordered[,!colnames(rle_mat_meta_ordered) %in% colnames(meta)])
    rle_meta <- rle_mat_meta_ordered[,colnames(rle_mat_meta_ordered) %in% colnames(meta)]
    RLE_SCE <- SingleCellExperiment::SingleCellExperiment(
      assays = list(counts = as.matrix(rle_mat_ordered)),
      colData = rle_meta,
      rowData = rownames(mat)
    )
    evaluation_rle_list$batch_colored_rle <- scater::plotRLE(
      RLE_SCE,
      exprs_values = "counts",
      colour_by = batch.1,
      BPPARAM = bpparam_rle
    )+
      ggtitle(plot_title)+
      theme(axis.text.x = element_text(size = 18),
            axis.title.x = element_text(size = 18),
            axis.text.y = element_text(size = 18),
            axis.title.y = element_text(size = 18),
            legend.title = element_text(size = 18),
            legend.text = element_text(size = 18),
            plot.title = element_text(size = 18))+
      labs(color = variable_of_interest)
  }
  if ("variable_of_interest" %in% color_by){
    rle_mat <- mat
    rle_mat_meta <- cbind(t(rle_mat), meta)
    rle_mat_meta_ordered <- rle_mat_meta[order(rle_mat_meta[[variable_of_interest]]),]
    rle_mat_ordered <- t(rle_mat_meta_ordered[,!colnames(rle_mat_meta_ordered) %in% colnames(meta)])
    rle_meta <- rle_mat_meta_ordered[,colnames(rle_mat_meta_ordered) %in% colnames(meta)]
    RLE_SCE <- SingleCellExperiment::SingleCellExperiment(
      assays = list(counts = as.matrix(rle_mat_ordered)),
      colData = rle_meta,
      rowData = rownames(mat),
    )
    evaluation_rle_list$voi_colored_rle <- scater::plotRLE(
      RLE_SCE,
      exprs_values = "counts",
      colour_by = variable_of_interest,
      BPPARAM = bpparam_rle
    )+
      ggtitle(plot_title)+
      theme(axis.text.x = element_text(size = 18),
            axis.title.x = element_text(size = 18),
            axis.text.y = element_text(size = 18),
            axis.title.y = element_text(size = 18),
            legend.title = element_text(size = 18),
            legend.text = element_text(size = 18),
            plot.title = element_text(size = 18))+
      labs(color = variable_of_interest)
  }
  if ("BnW" %in% color_by){
    RLE_SCE <- SingleCellExperiment::SingleCellExperiment(
      assays = list(counts = as.matrix(rle_mat)),
      colData = meta,
      rowData = rownames(mat)
    )
    evaluation_rle_list$bnW_colored_rle <- scater::plotRLE(
      RLE_SCE,
      exprs_values = "counts",
      BPPARAM = bpparam_rle
    )+
      ggtitle(plot_title)+
      theme(axis.text.x = element_text(size = 18),
            axis.title.x = element_text(size = 18),
            axis.text.y = element_text(size = 18),
            axis.title.y = element_text(size = 18),
            legend.title = element_text(size = 18),
            legend.text = element_text(size = 18),
            plot.title = element_text(size = 18))
  }
  BiocParallel::bpstop(bpparam_rle)

  return(evaluation_rle_list)
}
